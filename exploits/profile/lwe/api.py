import requests

PORT = 20561

class API:
    def __init__(self, hostname):
        self.hostname = hostname
        self.session = requests.Session()

    def __enter__(self):
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        self.session.close()

    def health_check(self):
        with self.session.get('http://{}:{}/'.format(self.hostname, PORT)) as r:
            return r.status

    def get_pub_key(self, algo, login):
        with self.session.get('http://{}:{}/get_pub_key'.format(self.hostname, PORT), params={'login': login, 'algo': algo}) as r:
            return r.json()

    def sign(self, algo, login, data):
        data = {
            'login': login,
            'algo': algo,
            'data': data
        }
        with self.session.post('http://{}:{}/sign'.format(self.hostname, PORT), data=data) as r:
            return r.json()


    def verify(self, algo, login, signature, note_hash):
        data = {
            'login': login,
            'algo': algo,
            's': signature,
            'h': note_hash
        }
        with self.session.post('http://{}:{}/verify'.format(self.hostname, PORT), data=data) as r:
            return r.json()

    def get_users(self):
        with self.session.get('http://{}:{}/get_users'.format(self.hostname, PORT)) as r:
            return r.json()
    
    def get_notes(self, algo, login):
        with self.session.get('http://{}:{}/get_notes'.format(self.hostname, PORT), params={'login': login, 'algo': algo}) as r:
            return r.json()