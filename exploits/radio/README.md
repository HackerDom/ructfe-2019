# Radio

Radio is a service when you can listen to a music. Flag put in playlist description

## Vuln 1

In radio you need register user and login. When you register, you can create playlist (private and public)
Vulnerability in private playlist. When you get playlist by share link that not check private or public it. Therefore you
can generate hash and steal flag from description

## Vuln 2

Radio service has radio_auth library. JWT sign formed by next algorithm

```go
func Sign(src string, secret string) string {
	key := []byte(secret)
	s1 := hmac.New(sha256.New, []byte(fmt.Sprintf("%c", key[0]))).Sum(nil)
	s2 := hmac.New(sha512.New, []byte(fmt.Sprintf("%c", key[1]))).Sum(nil)
	s3 := hmac.New(sha1.New, []byte(strings.Join([]string{string(s1), string(s2)}, ""))).Sum(nil)
	s4 := ""
	for i := 1; i < len(s3)-1; i++ {
		if i%2 == 0 {
			s4 = s4 + string(s3[len(s3)-i])
		} else {
			s4 = s4 + string(s3[i])
		}
	}
	h := hmac.New(sha256.New, []byte(s4))
	h.Write([]byte(s4))
	return base64.StdEncoding.EncodeToString([]byte(string([]byte(string(h.Sum(nil))+string(s1))) + string(s2)))
}
```

and secret key is not full secret key, function which get secret for a sign key

```go
func getSecret() string {
	f := func(r ...int) string {
		re := ""
		for i, _ := range r {
			re = re + string(jwtSecret[i])
		}
		return re
	}
	return f(1, 4)
}
```

You need reverse library if you want exploit vulnerability


## Vuln 3

Generate secret key script:

```bash
#!/bin/bash
set -e

generate_key() {
    declare -r key_path=$1
    echo -n "$(date +\"%s\")$key_path" | sha256sum | awk '{print $1}' > $key_path
}

declare -r jwt_secret_path="${SECRET_PATH%/}/jwt_secret"
declare -r session_key="${SECRET_PATH%/}/session_key"

generate_key $jwt_secret_path
generate_key $session_key
```

As we see, algorithm depend by timestamp, and you can bruteforce session_key and jwt_secret. Therefore you can
try to sign session, it's really hard
