
# Guidelines по подготовке сервисов к деплою

Пример реализации всего нижеперечисленного есть в `example_service`.

**Главное:**
* в папке с сервисом должен лежать `docker-compose.yaml`
* сервис должен полностью запускаться по docker-compose up
* если для сервиса нужно заранее что-то скомпилировать, то можно написать скрипт `before_image_build.sh` и положить его в папку с сервисом
* этот скрипт должен опять же в докере собрать всё необходимое для сервиса
* Если часть файлов не нужно копировать в образ, то можно создать файлик `.rsync-filter` и указать в нём правила того, что не должно копироваться

**Ньюансы:**
* в `example_serice/docker-compose.yaml` есть пример как правильно делать ограничения памяти и других ресурсов, можно скопировать его к себе и подправить под свой сервис (закоментированные строчки я бы удалил)
* image для deploy'а должен содержать уже скомпилированный сервис, сервис из него должен стартовать мгновенно, не должен содержать ничего лишнего
* image должен работать не из под root'а, а безправного пользоватебя, в [примере Dockerfile](example_service/Dockerfile) можно подсмотреть как это сделать
